// stupid FF FOUT fix
function BezierHandle(e,t){this.x=e;this.y=t;this.width=12;this.height=12}function Graph(){this.x=0;this.y=130;this.height=200;this.width=200}function getPos(e){var t=e.pageX-getOffSet(e.target).left,n=e.pageY-getOffSet(e.target).top;return{x:t,y:n}}function getOffSet(e){var t=curtop=0;if(e.offsetParent){do{t+=e.offsetLeft;curtop+=e.offsetTop}while(e=e.offsetParent);return{left:t,top:curtop}}}function onPress(e){e.preventDefault();e.stopPropagation();var t=supportsTouch?e.touches[0]:e,n=getPos(t),r=n.x,i=n.y;for(var s=0;s<handles.length;s++){var o=handles[s],u=o.left,a=o.right,f=o.top,l=o.bottom;if(supportsTouch){u-=20;a+=20;f-=20;l+=20}if(r>=u&&r<=a&&i>=f&&i<=l){draggingObj=o;oldX=e.pageX;oldY=e.pageY;var c=$("#presets option:selected");c.removeAttr("selected").parent().parent().find("option").last().attr("selected","selected");document.addEventListener("mouseup",onRelease,!1);document.addEventListener("touchend",touchEnd,!1);document.addEventListener("mousemove",onMove,!1);document.addEventListener("touchmove",touchMove,!1);document.body.style.cursor=canvas.style.cursor="move"}}}function onMove(e){var t=supportsTouch?e.touches[0]:e,n=t.pageX-getOffSet(canvas).left,r=t.pageY-getOffSet(canvas).top;n>graph.width&&(n=graph.width);n<0&&(n=0);r>canvas.height&&(r=canvas.height);r<0&&(r=0);draggingObj.x=n;draggingObj.y=r;updateDrawing()}function touchMove(e){onMove(e);e.preventDefault()}function onRelease(e){drag=!1;canvas.style.cursor="pointer";document.body.style.cursor="default";document.removeEventListener("mousemove",onMove,!1);document.removeEventListener("touchmove",touchMove,!1);document.removeEventListener("mouseup",onRelease,!1);document.removeEventListener("touchend",touchEnd,!1)}function touchEnd(e){onRelease(e);e.preventDefault()}function updateDrawing(){ctx.clearRect(0,0,canvas.width,canvas.height);graph.draw();var e=handles[0],t=handles[1];ctx.save();ctx.strokeStyle="#4C84D3";ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(graph.x,graph.y+graph.height);ctx.bezierCurveTo(e.x,e.y,t.x,t.y,graph.width,graph.y);ctx.stroke();ctx.restore();ctx.strokeStyle="#f00";ctx.beginPath();ctx.moveTo(graph.x,graph.y+graph.height);ctx.lineTo(e.x,e.y);ctx.moveTo(graph.width,graph.y);ctx.lineTo(t.x,t.y);ctx.stroke();for(var n=0;n<handles.length;n++)handles[n].draw();var r=(e.x/graph.width).toFixed(3),i=((graph.height+graph.y-e.y)/graph.height).toFixed(3),s=(t.x/canvas.width).toFixed(3),o=((graph.height+graph.y-t.y)/graph.height).toFixed(3),u="("+r+", "+i+", "+s+", "+o+")",a="cubic-bezier"+u,f=$("#presets option:selected").text();f.indexOf("custom")>-1&&(f="custom");var l="-webkit-transition: all "+timeVal+"ms "+a,c="-webkit-transition-timing-function: "+a;if(i>1||i<0||o>1||o<0){var h=i,p=o;i>1&&(h=1);i<0&&(h=0);o>1&&(p=1);o<0&&(p=0);l="-webkit-transition: all "+timeVal+"ms "+"cubic-bezier("+r+", "+h+", "+s+", "+p+")"+"; /* older webkit */"+"<br>-webkit-transition: all "+timeVal+"ms "+a;c="-webkit-transition-timing-function: cubic-bezier("+r+", "+h+", "+s+", "+p+")"+"; /* older webkit */"+"<br>-webkit-transition-timing-function: "+a}code.innerHTML="<p>"+l+"; <br>&nbsp;&nbsp; -moz-transition: all "+timeVal+"ms "+a+"; <br>&nbsp;&nbsp;&nbsp;&nbsp; -o-transition: all "+timeVal+"ms "+a+"; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; transition: all "+timeVal+"ms "+a+"; /* "+f+" */</p>"+"<p>"+c+"; <br>&nbsp;&nbsp; -moz-transition-timing-function: "+a+"; <br>&nbsp;&nbsp;&nbsp;&nbsp; -o-transition-timing-function: "+a+"; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; transition-timing-function: "+a+"; /* "+f+" */</p>"}function setTransitions(){var e=handles[0],t=handles[1],n=(e.x/graph.width).toFixed(3),r=((graph.height+graph.y-e.y)/graph.height).toFixed(3),i=(t.x/canvas.width).toFixed(3),s=((graph.height+graph.y-t.y)/graph.height).toFixed(3),o="("+n+", "+r+", "+i+", "+s+")";timeVal=time.value;box.style.WebkitTransition=box.style.MozTransition=box.style.MsTransition=box.style.OTransition=box.style.transition="all "+timeVal+"ms cubic-bezier"+o;if(!supportsBezierRange){var u,a;r>1&&(u=1);r<0&&(u=0);s>1&&(a=1);s<0&&(a=0);box.style.WebkitTransition="all "+timeVal+"ms cubic-bezier"+"("+n+", "+u+", "+i+", "+a+")"}}function presetChange(){var e=this.value.split(","),t=handles[0],n=handles[1];t.x=e[0]*graph.width;t.y=graph.y+graph.height-e[1]*graph.height;n.x=e[2]*graph.width;n.y=graph.y+graph.height-e[3]*graph.height;updateDrawing()}$("h1 span").css("display","inline-block");var canvas=document.getElementById("curve"),ctx=canvas.getContext("2d"),box=document.getElementById("box"),code=document.getElementById("codeOutput"),supportsTouch="createTouch"in document,time=document.getElementById("time"),timeVal=500,supportsBezierRange=function(){var e=document.createElement("div");e.style.WebkitTransitionTimingFunction="cubic-bezier(1,0,0,1.1)";return!!e.style.WebkitTransitionTimingFunction.length}();BezierHandle.prototype={getSides:function(){this.left=this.x-this.width/2;this.right=this.left+this.width;this.top=this.y-this.height/2;this.bottom=this.top+this.height},draw:function(){this.getSides();ctx.fillStyle="#222";ctx.fillRect(this.left,this.top,this.width,this.height)}};var handles=[new BezierHandle(50,280),new BezierHandle(150,180)];Graph.prototype={draw:function(){ctx.save();ctx.fillStyle="#fff";ctx.fillRect(this.x,this.y,this.width,this.height);ctx.strokeStyle="#666";ctx.lineWidth=1;ctx.strokeRect(this.x+.5,this.y-.5,this.width-1,this.height);ctx.restore()}};var graph=new Graph,drag=!1,draggingObj,oldX,oldY;canvas.addEventListener("mousedown",onPress,!1);canvas.addEventListener("touchstart",function(t){onPress(t);t.preventDefault()},!1);var $presets=$("#presets"),$time=$("#time"),$presetOpts=$("#presets option");$presets.change(presetChange);$(".testButton").click(function(){setTransitions();$("#box").toggleClass($(this).val())});$time.change(function(){setTransitions();updateDrawing()});$time.keyup(function(){$(this).trigger("change")});$(document).keydown(function(e){var t,n;if(e.keyCode===39&&e.target!==time){t=$("#presets option:selected");n=$presetOpts.index(t);if(n<$presetOpts.length-1){t.attr("selected","");$presetOpts.eq(n+1).attr("selected","selected");$presets.trigger("change")}}else if(e.keyCode===37&&e.target!==time){t=$("#presets option:selected");n=$presetOpts.index(t);if(n>0){t.attr("selected","");$presetOpts.eq(n-1).attr("selected","selected");$presets.trigger("change")}}});setTransitions();$presets.trigger("change");